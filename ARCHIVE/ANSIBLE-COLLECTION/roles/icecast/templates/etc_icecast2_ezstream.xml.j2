<!--
   EXAMPLE: Ogg Vorbis playlist stream with reencoding for use with
            ezstream-file.sh(1)

   This example streams a playlist generated by ezstream-file.sh(1) and
   reencodes to Ogg Vorbis.
 -->
<ezstream>
    <url>http://localhost:7332/stream</url>
    <sourcepassword>{{ icecast_source_password }}</sourcepassword>
    <!--
       Since the reencoding feature is enabled below, <format /> sets the
       output format of the stream.
     -->
    <format>VORBIS</format>
    <!--
       To function as a template for ezstream-file.sh(1), the <filename />
       configuration must be as follows:
     -->
    <filename>/etc/icecast2/playlist.m3u</filename>
    <!--
      The usual, remaining configuration statements follow. See the other
      examples and the documentation for details.
     -->
    <svrinfoname>{{ icecast_info_name }}</svrinfoname>
    <svrinfourl>{{ icecast_info_url }}</svrinfourl>
    <svrinfobitrate>{{ icecast_bitrate }}</svrinfobitrate>
    <svrinfoquality>1.5</svrinfoquality>
    <svrinfochannels>2</svrinfochannels>
    <svrinfosamplerate>44100</svrinfosamplerate>
    <reencode>
        <enable>1</enable>
        <encdec>
            <format>FLAC</format>
            <match>.flac</match>
            <decode>flac -s -d --force-raw-format --sign=signed --endian=little -o - "@T@"</decode>
        </encdec>
        <encdec>
            <format>MP3</format>
            <match>.mp3</match>
            <decode>madplay -b 16 -R 44100 -S -o raw:- "@T@"</decode>
            <encode>lame --preset cbr 128 -r -s 44.1 --bitwidth 16 - -</encode>
        </encdec>
        <encdec>
            <format>VORBIS</format>
            <match>.ogg</match>
            <decode>oggdec -R -b 16 -e 0 -s 1 -o - "@T@"</decode>
            <encode>oggenc -r -B 16 -C 2 -R 44100 --raw-endianness 0 -q 1.5 -t "@M@" -</encode>
        </encdec>
        <!-- TODO add support for opus/m4a -->
    </reencode>
</ezstream>
